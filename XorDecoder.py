def main():   
    key = 1
    while key<256:
        i=0
        #print key
        data = open("C:/trickbot","rb")
        while 1:
            i=i+2
            c = data.read(2)
            try:
                s  = key^ord(c[0])
                t  = key^ord(c[1])    #Index Error
                if t==77:
                    i = i + 1
                    d = data.read(1)  #4D In Tail TypeError
                    r = key^ord(d)  
                    if r ==90:
                        JudgePE(data,key,i)
                if s==77 and t ==90:  #"MZ" flag
                    JudgePE(data,key,i)
                
                if t==46:             #.com
                    l = data.read(3)
                    m  = key^ord(l[0])
                    n  = key^ord(l[1])
                    o  = key^ord(l[2])
                    if m ==99 and n==111 and o==109:
                        print key
                        print hex(i-1)
                        print "Find URL!"
                    data.seek(-3,1)
                if s==46 and t ==99:  #.com
                    l = data.read(2)
                    m  = key^ord(l[0])
                    n  = key^ord(l[1])
                    if m ==111 and n==109:
                        print key
                        print hex(i-2)
                        print "Find URL!"
                    data.seek(-2,1)
                          
            except Exception as e:
                break
                
        data.close()
        key = key + 1

def JudgePE(data,key,i):
    dosheader = data.read(60)             #0x3C = 60
    s  = key^ord(dosheader[58])
    t = key^ord(dosheader[59])
    offset = t*16+s
    pe = data.read(offset-60)
    s  = key^ord(pe[offset-62])
    t = key^ord(pe[offset-61])
    if s == 80 and t == 69:          #"PE" flag
        print key
        print hex(i-2)
        print "Find PE!"
    data.seek(-offset,1)
       
if __name__ == '__main__':
    main()
